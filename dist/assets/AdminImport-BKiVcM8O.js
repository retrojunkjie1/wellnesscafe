import{r as l,j as s}from"./react-vendor-B5xUu9wX.js";import{S as f}from"./index-B7Anqe97.js";import{al as w,a as S,d as v,c as I,k as $}from"./core-libs-BseDu1u3.js";import"./ai-engine-BQFxlMsO.js";import"./ui-heavy-8XJPmDUO.js";import"./index-DIOk37Xh.js";const C=Object.entries(f).map(([e,o])=>({slug:e,name:o.name})).sort((e,o)=>e.name.localeCompare(o.name)),y=e=>{const o=(e.name||"home").toString().toLowerCase().trim(),a=(e.city||e.address||"").toString().toLowerCase().trim();return`${o}-${a}`.replaceAll(/[^a-z0-9]+/g,"-").replaceAll(/(^-|-$)/g,"")},O=e=>{let o=[];Array.isArray(e.categories)?o=e.categories:Array.isArray(e.category)?o=e.category:typeof e.category=="string"&&(o=[e.category]);let a=e.insurance??e.insuranceType??e.insuranceTypes;typeof a=="string"&&(a=a.split(/[,/|]/).map(c=>c.trim()).filter(Boolean)),Array.isArray(a)||(a=a?[String(a)]:[]);const m=typeof e.contact=="object"&&e.contact?e.contact:{website:e.website||void 0,phone:e.phone||void 0,email:e.email||void 0};return{...e,categories:o,insurance:a,contact:m}},L=()=>{const[e,o]=l.useState(""),[a,m]=l.useState([]),[c,d]=l.useState(!1),[p,n]=l.useState(""),g=l.useRef(null),x=async t=>{const i=await t.text(),r=JSON.parse(i);return Array.isArray(r)?r:r&&Array.isArray(r.homes)?r.homes:[]},j=async()=>{n("");const t=g.current?.files?.[0];if(!e){n("Select a state");return}if(!t){n("Choose a JSON file");return}try{const r=(await x(t)).map(O);m(r),n(`Loaded ${r.length} homes`)}catch(i){n(`Failed to parse JSON: ${i?.message||i}`)}},b=async()=>{if(!a.length){n("Nothing to import");return}d(!0),n("Importing...");try{const t=w(),i=S(t);let r=0;for(const u of a){const h=y(u),N=v(I(i,`soberHomes/${e}/homes`),h);await $(N,u,{merge:!0}),r+=1,r%200===0&&await new Promise(A=>setTimeout(A,200))}n(`Imported ${r} homes to ${f[e]?.name||e}`)}catch(t){n(`Import failed: ${t?.message||t}`)}finally{d(!1)}};return s.jsxs("main",{className:"container max-w-[980px] my-8 mx-auto px-4",children:[s.jsxs("div",{className:"page-hero",children:[s.jsx("h1",{children:"Admin JSON Import"}),s.jsx("p",{children:"Upload a JSON file to import sober homes into Firestore."})]}),s.jsxs("div",{className:"flex flex-col gap-3 p-4 rounded-2xl border border-gray-200 bg-white/60 backdrop-blur-md",children:[s.jsxs("div",{className:"flex flex-col md:flex-row gap-3",children:[s.jsxs("select",{value:e,onChange:t=>o(t.target.value),className:"w-full md:w-64 rounded-md border border-gray-300 px-3 py-2 text-sm","aria-label":"Select state",children:[s.jsx("option",{value:"",children:"Select state…"}),C.map(t=>s.jsx("option",{value:t.slug,children:t.name},t.slug))]}),s.jsx("input",{type:"file",accept:"application/json",ref:g,className:"w-full md:flex-1"}),s.jsx("button",{type:"button",className:"ghost-btn",onClick:j,disabled:c,children:"Preview"}),s.jsx("button",{type:"button",className:"ghost-btn",onClick:b,disabled:c||!a.length||!e,children:c?"Importing…":"Import to Firestore"})]}),p&&s.jsx("div",{className:"text-sm text-gray-700",children:p})]}),!!a.length&&s.jsx("section",{className:"card-grid section mt-4",children:a.slice(0,12).map(t=>{const i=y(t);return s.jsxs("div",{className:"p-card",children:[s.jsx("h3",{children:t.name}),s.jsx("p",{className:"text-gray-700 my-1.5",children:t.address||t.city}),s.jsx("p",{className:"text-gray-800 my-1.5",children:Array.isArray(t.insurance)?t.insurance.join(", "):""}),Array.isArray(t.categories)&&t.categories.length>0&&s.jsx("p",{className:"my-1.5",children:t.categories.map(r=>s.jsx("span",{className:"specialty-tag mr-1.5",children:r},r))}),t.verified&&s.jsx("span",{className:"specialty-tag mr-1.5",children:"Verified"})]},i)})})]})};export{L as default};
