import{r,j as t,i as de,L as ee}from"./react-vendor-DQKasmcJ.js";import{P as me}from"./PageBanner-BV1wwEH_.js";import{S as pe,a as xe}from"./index-C36ztl4k.js";import{d as V}from"./ai-engine-BvKxDwCC.js";import{f as te,c as se,b as ue,d as ge}from"./core-libs-CRuXokP_.js";import"./ui-heavy-yHDudVwC.js";const ye=({stateSlug:b,snippets:d})=>{const[S,I]=r.useState(!1),[u,k]=r.useState(""),[g,m]=r.useState(!1),[H,j]=r.useState([]),y=r.useRef(null),D=r.useMemo(()=>!g&&u.trim().length>1,[g,u]),A=async()=>{if(!D)return;const n=u.trim();k(""),m(!0);const M=`${Date.now()}-${Math.random().toString(36).slice(2,8)}`;j(v=>[...v,{id:M,role:"user",text:n}]);try{const o=await(await fetch("/api/aiAsk",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:n,state:b||void 0,category:"soberHomes",snippets:Array.isArray(d)&&d.length?d.slice(0,5):void 0})})).json();let x="No response";o?.text?x=o.text:o?.error&&(x=`Error: ${o.error}`);const N=`${Date.now()}-${Math.random().toString(36).slice(2,8)}`;j($=>[...$,{id:N,role:"assistant",text:x}]),m(!1),requestAnimationFrame(()=>{y.current&&(y.current.scrollTop=y.current.scrollHeight)})}catch(v){console.error("AskWellnessAI send error",v);const o=`${Date.now()}-${Math.random().toString(36).slice(2,8)}`;j(x=>[...x,{id:o,role:"assistant",text:"Error contacting AI."}]),m(!1)}};return t.jsxs("div",{children:[t.jsx("button",{type:"button",className:"fixed bottom-5 right-5 bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-full shadow-lg",onClick:()=>I(n=>!n),"aria-expanded":S?"true":"false","aria-controls":"ask-wellness-ai",children:S?"Close AI":"Ask Wellness AI"}),S&&t.jsxs("div",{id:"ask-wellness-ai",className:"fixed bottom-20 right-5 w-[min(92vw,380px)] max-h-[70vh] bg-white border border-gray-200 rounded-xl shadow-xl flex flex-col",children:[t.jsxs("div",{className:"px-4 py-2 border-b border-gray-200 flex items-center justify-between",children:[t.jsx("div",{className:"text-sm font-semibold",children:"WellnessCafe AI"}),t.jsx("div",{className:"text-xs text-gray-500",children:"Experimental"})]}),t.jsxs("div",{ref:y,className:"flex-1 overflow-y-auto px-4 py-3 space-y-3",children:[H.length===0&&t.jsx("p",{className:"text-sm text-gray-500",children:'Ask about sober living, referrals, or resources. Example: "Find sober living options in Florida with MAT."'}),H.map(n=>t.jsx("div",{className:n.role==="user"?"text-right":"text-left",children:t.jsx("div",{className:n.role==="user"?"inline-block bg-indigo-600 text-white px-3 py-2 rounded-2xl":"inline-block bg-gray-100 text-gray-800 px-3 py-2 rounded-2xl",children:t.jsx("div",{className:"text-sm whitespace-pre-wrap",children:n.text})})},n.id))]}),t.jsxs("div",{className:"p-3 border-t border-gray-200",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"text",value:u,onChange:n=>k(n.target.value),onKeyDown:n=>{n.key==="Enter"&&(n.preventDefault(),A())},className:"flex-1 rounded-md border border-gray-300 px-3 py-2 text-sm",placeholder:"Type your question...","aria-label":"Ask Wellness AI",disabled:g}),t.jsx("button",{type:"button",className:"ghost-btn",onClick:A,disabled:!D,children:g?"...":"Send"})]}),t.jsx("p",{className:"text-[11px] text-gray-500 mt-1",children:"AI may make mistakes. Verify important info."})]})]})]})},fe=b=>b.replaceAll("-"," ").split(" ").map(d=>d?d.charAt(0).toUpperCase()+d.slice(1):"").join(" "),Se=()=>{const{state:b}=de(),[d,S]=r.useState(null),[I,u]=r.useState([]),[k,g]=r.useState([]),[m,H]=r.useState(null),[j,y]=r.useState(""),[D,A]=r.useState(!0),[n,M]=r.useState(""),[v,o]=r.useState(1),x=20,[N,$]=r.useState(""),[O,q]=r.useState(""),[U,G]=r.useState(!1),[L,_]=r.useState(""),f=(b||"").toLowerCase(),P=pe[f]?.name||fe(b||"");if(r.useEffect(()=>{let e=!0;return(async()=>{A(!0),y("");try{const s=xe[f];if(!s)throw new Error("State not yet available");const c=await s();e&&S(c?.default||c)}catch(s){e&&y(s?.message||"Failed to load state data")}finally{e&&A(!1)}})(),()=>{e=!1}},[f]),r.useEffect(()=>{let e=!0;return(async()=>{if(!V){u([]),g([]);return}try{const c=(await te(se(V,`soberHomes/${f}/homes`))).docs.map(l=>({id:l.id,...l.data()}));if(!e)return;u(c);const a=(await te(se(V,`soberHomes/${f}/homes`))).docs.map(l=>{const p=l.data();return p.sourceUrl?.includes("oxfordvacancies")?{id:l.id,...p,lastUpdated:p.lastUpdated?.toDate?p.lastUpdated.toDate():p.lastUpdated,scrapedAt:p.scrapedAt?.toDate?p.scrapedAt.toDate():p.scrapedAt}:null}).filter(Boolean);if(!e)return;g(a);const h=await ue(ge(V,"scrapingMetadata","oxfordHouses"));if(h.exists()&&e){const l=h.data();H({...l,lastScraped:l.lastScraped?.toDate?l.lastScraped.toDate():l.lastScraped})}}catch(s){if(console.warn("firestore homes fetch failed",s),!e)return;u([]),g([])}})(),()=>{e=!1}},[f]),D)return t.jsx("div",{className:"container max-w-[960px] my-8 mx-auto",children:"Loading resourcesâ€¦"});if(j)return t.jsxs("div",{className:"container max-w-[960px] my-8 mx-auto px-4",children:[t.jsxs("h1",{children:["Sober Living Homes in ",P]}),t.jsx("p",{className:"text-gray-600 mt-2",children:j}),t.jsx("p",{className:"mt-4",children:t.jsx(ee,{to:"/assistance",className:"ghost-btn",children:"Back to Assistance"})})]});const ae=e=>[{name:`${e} 211 (United Way)`,city:"Statewide",type:"Referral & housing navigation",description:"Call 211 or visit 211.org for sober living and recovery referrals in your area.",apply:"Call 211 for live assistance.",contact:"https://www.211.org/"},{name:"SAMHSA Treatment & Recovery Locator",city:"Statewide",type:"Treatment, recovery housing, support",description:"Find local treatment and recovery resources that can connect you to sober living homes.",apply:"Search and contact providers.",contact:"https://findtreatment.gov/"},{name:"Oxford House Directory",city:"Statewide",type:"Peer-run sober housing",description:"Search Oxford House listings. Availability varies by city and county.",apply:"Contact houses directly to check openings.",contact:"https://www.oxfordhouse.org/directory"},{name:"Veterans Affairs (VA) Housing & Support",city:"Statewide",type:"Veteran transitional resources",description:"Veterans can access housing and recovery supports via VA and community partners.",apply:"Contact VA or local veteran services.",contact:"https://www.va.gov/"},{name:`${e} Drug Court / Problem-Solving Court Housing`,city:"County-based",type:"Justice-involved sober living",description:"Some sober living providers coordinate with Drug Courts and probation.",apply:"Ask your court officer or case manager for connected providers.",contact:""}],J=[...I,...k.map(e=>({...e,name:e.houseName,type:"Oxford House - Peer-Run Sober Living",isOxfordHouse:!0}))],W=J.length>0?J:d?.homes&&d.homes.length>0?d.homes:ae(P),Z=e=>{if(e?.city&&String(e.city).trim())return String(e.city).trim();const s=String(e?.address||"").trim(),i=/([^,]+),\s*[A-Z]{2}\b/.exec(s);if(i?.[1])return i[1].trim();const a=s.split(",");return a.length>=2?a.at(-2).trim():""},w=(n||"").toLowerCase(),E=e=>{const s=e?.insurance??e?.insuranceType??e?.insuranceTypes;return s?Array.isArray(s)?s.map(String):typeof s=="string"?s.split(/[,/|]/).map(c=>c.trim()).filter(Boolean):[]:[]},z=new Set;for(const e of W){const s=Z(e);s&&z.add(s)}const re=Array.from(z).sort((e,s)=>e.localeCompare(s)),K=new Set;for(const e of W)for(const s of E(e))K.add(s);const ne=Array.from(K).sort((e,s)=>e.localeCompare(s)),C=W.filter(e=>{const s=(e?.name||"").toLowerCase(),i=(Z(e)||"").toLowerCase(),a=(e?.type||"").toLowerCase();let h=[];Array.isArray(e?.categories)?h=e.categories:Array.isArray(e?.category)?h=e.category:typeof e?.category=="string"&&(h=[e.category]);const l=h.join(" ").toLowerCase(),p=E(e).map(B=>B.toLowerCase()),ce=e.isOxfordHouse?e.hasVacancy:!0,le=e.isOxfordHouse&&L?e.gender===L:!0;return(!w||s.includes(w)||i.includes(w)||a.includes(w)||l.includes(w)||p.some(B=>B.includes(w)))&&(!N||i===N.toLowerCase())&&(!O||p.includes(O.toLowerCase()))&&(!U||ce)&&le}),R=C.length,T=Math.max(1,Math.ceil(R/x)),F=Math.min(v,T),Q=(F-1)*x,oe=C.slice(Q,Q+x),ie=C.slice(0,5).map(e=>({name:e.name,city:e.city,type:e.type})),X=e=>e?(new Date-new Date(e))/(1e3*60*60*24)>7:!0,Y=e=>e?new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"}):"Unknown";return t.jsxs("div",{children:[t.jsx(me,{imageSrc:"undefined/images/community.jpg",altText:`Sober Living in ${P}`}),t.jsxs("main",{className:"container max-w-[980px] my-8 mx-auto px-4",children:[t.jsxs("div",{className:"page-hero",children:[t.jsxs("h1",{children:["Sober Living Homes in ",P]}),t.jsx("p",{children:"Curated list of sober living and transitional recovery housing resources including real-time Oxford House vacancies."})]}),m&&t.jsx("div",{className:`p-4 rounded-lg mb-4 ${X(m.lastScraped)?"bg-yellow-50 border border-yellow-200":"bg-green-50 border border-green-200"}`,children:t.jsx("div",{className:"flex items-start justify-between",children:t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold text-sm mb-1",children:X(m.lastScraped)?"âš ï¸ Data may be outdated":"âœ… Oxford House data is fresh"}),t.jsxs("p",{className:"text-sm text-gray-700",children:["Last updated: ",Y(m.lastScraped)]}),m.totalHouses>0&&t.jsxs("p",{className:"text-sm text-gray-700 mt-1",children:[m.totalHouses," Oxford Houses tracked â€¢"," ",m.housesWithVacancies," with vacancies"]})]})})}),t.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-3 py-3 border-b border-gray-200",children:[t.jsxs("div",{className:"flex-1 flex flex-col md:flex-row gap-3",children:[t.jsx("input",{type:"search",value:n,onChange:e=>{M(e.target.value),o(1)},placeholder:"Search by name, city, type, category or insurance",className:"w-full md:flex-1 rounded-md border border-gray-300 px-3 py-2 text-sm backdrop-blur-md bg-white/60","aria-label":"Search sober homes"}),t.jsxs("select",{value:N,onChange:e=>{$(e.target.value),o(1)},className:"w-full md:w-56 rounded-md border border-gray-300 px-3 py-2 text-sm backdrop-blur-md bg-white/60","aria-label":"Filter by city",children:[t.jsx("option",{value:"",children:"All cities"}),re.map(e=>t.jsx("option",{value:e,children:e},e))]}),t.jsxs("select",{value:O,onChange:e=>{q(e.target.value),o(1)},className:"w-full md:w-56 rounded-md border border-gray-300 px-3 py-2 text-sm backdrop-blur-md bg-white/60","aria-label":"Filter by insurance",children:[t.jsx("option",{value:"",children:"All insurance"}),ne.map(e=>t.jsx("option",{value:e,children:e},e))]}),t.jsxs("select",{value:L,onChange:e=>{_(e.target.value),o(1)},className:"w-full md:w-40 rounded-md border border-gray-300 px-3 py-2 text-sm backdrop-blur-md bg-white/60","aria-label":"Filter by gender",children:[t.jsx("option",{value:"",children:"All genders"}),t.jsx("option",{value:"M",children:"Men"}),t.jsx("option",{value:"W",children:"Women"}),t.jsx("option",{value:"MC",children:"Men + Children"})]}),t.jsxs("label",{className:"flex items-center gap-2 px-3 py-2 text-sm cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:U,onChange:e=>{G(e.target.checked),o(1)},className:"rounded border-gray-300"}),t.jsx("span",{className:"whitespace-nowrap",children:"Only vacancies"})]}),(N||O||n||L||U)&&t.jsx("button",{type:"button",className:"ghost-btn",onClick:()=>{M(""),$(""),q(""),_(""),G(!1),o(1)},children:"Clear"})]}),t.jsxs("div",{className:"text-sm text-gray-600",children:[R," result",R===1?"":"s"]})]}),t.jsxs("section",{className:"card-grid section",children:[oe.map(e=>{const s=e.id||`${e.name}-${e.city}`,c=typeof e.contact=="string"?e.contact:e.contact?.website,i=e.isOxfordHouse;return t.jsxs("div",{className:`p-card ${i?"border-l-4 border-blue-500":""}`,children:[t.jsxs("div",{className:"flex items-start justify-between mb-2",children:[t.jsx("h3",{children:e.name}),i&&t.jsx("span",{className:"text-xs px-2 py-1 bg-blue-100 text-blue-800 rounded-full",children:"Oxford House"})]}),t.jsxs("p",{className:"text-gray-700 my-1.5",children:["ðŸ“ ",e.city,e.county?`, ${e.county}`:""]}),i&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"my-2 p-3 bg-gray-50 rounded-lg",children:t.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[t.jsxs("div",{children:[t.jsx("span",{className:"font-semibold",children:"Gender:"})," ",e.gender==="M"?"Men":e.gender==="W"?"Women":e.gender==="MC"?"Men + Children":e.gender]}),t.jsxs("div",{children:[t.jsx("span",{className:"font-semibold",children:"Capacity:"})," ",e.capacity," beds"]}),t.jsxs("div",{className:"col-span-2",children:[t.jsx("span",{className:"font-semibold",children:"Vacancies:"})," ",t.jsx("span",{className:`font-bold ${e.vacancies>0?"text-green-600":"text-red-600"}`,children:e.vacancies>0?`${e.vacancies} bed${e.vacancies===1?"":"s"} available`:"Full"})]}),e.meetingTime&&t.jsxs("div",{className:"col-span-2",children:[t.jsx("span",{className:"font-semibold",children:"House Meeting:"})," ",e.meetingTime]})]})}),e.contact&&t.jsxs("div",{className:"my-2",children:[t.jsxs("p",{className:"text-sm text-gray-700",children:[t.jsx("span",{className:"font-semibold",children:"House:"})," ",e.contact.housePhone||"â€”"]}),e.contact.managerName&&t.jsxs("p",{className:"text-sm text-gray-700",children:[t.jsx("span",{className:"font-semibold",children:"Manager:"})," ",e.contact.managerName,e.contact.managerPhone&&` â€¢ ${e.contact.managerPhone}`]})]}),e.lastUpdated&&t.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Updated: ",Y(e.lastUpdated)]})]}),!i&&t.jsxs(t.Fragment,{children:[t.jsx("p",{className:"text-gray-800 my-1.5",children:e.type}),e.verified&&t.jsx("span",{className:"specialty-tag mr-1.5",children:"Verified"}),Array.isArray(e.categories)&&e.categories.length>0&&t.jsx("p",{className:"my-1.5",children:e.categories.map(a=>t.jsx("span",{className:"specialty-tag mr-1.5",children:a},a))}),E(e).length>0&&t.jsx("p",{className:"my-1.5",children:E(e).map(a=>t.jsx("span",{className:"specialty-tag mr-1.5",children:a},a))}),e.description&&t.jsx("p",{className:"text-gray-700 my-1.5",children:e.description}),e.address&&t.jsx("p",{className:"text-gray-700 my-1.5",children:e.address}),e.apply&&t.jsx("p",{className:"text-gray-600 my-2",children:e.apply}),(e.referral||e.financing)&&t.jsxs("div",{className:"flex flex-wrap gap-2 mt-2",children:[e.referral&&t.jsxs("span",{className:"specialty-tag",children:["Referrals:"," ",Object.entries(e.referral).filter(([,a])=>a).map(([a])=>a).join(", ")||"â€”"]}),e.financing&&t.jsxs("span",{className:"specialty-tag",children:["Financing:"," ",Object.entries(e.financing).filter(([,a])=>a).map(([a])=>a).join(", ")||"â€”"]})]})]}),t.jsxs("div",{className:"flex flex-wrap gap-2 mt-3",children:[i&&e.contact?.housePhone&&t.jsx("a",{href:`tel:${e.contact.housePhone}`,className:"ghost-btn text-sm",children:"ðŸ“ž Call House"}),i&&e.contact?.managerPhone&&t.jsx("a",{href:`tel:${e.contact.managerPhone}`,className:"ghost-btn text-sm",children:"ðŸ“ž Call Manager"}),c&&t.jsx("a",{href:c,target:"_blank",rel:"noopener noreferrer",className:"ghost-btn text-sm",children:"ðŸŒ Visit site"}),!i&&typeof e.contact=="object"&&t.jsxs(t.Fragment,{children:[e.contact?.phone&&t.jsx("a",{href:`tel:${e.contact.phone}`,className:"ghost-btn text-sm",children:"ðŸ“ž Call"}),e.contact?.email&&t.jsx("a",{href:`mailto:${e.contact.email}`,className:"ghost-btn text-sm",children:"âœ‰ï¸ Email"})]})]})]},s)}),C.length===0&&t.jsx("p",{children:"No listings found for this state."})]}),C.length>x&&t.jsxs("div",{className:"flex items-center justify-between mt-4",children:[t.jsx("button",{type:"button",className:"ghost-btn",disabled:F<=1,onClick:()=>o(e=>Math.max(1,e-1)),children:"Previous"}),t.jsxs("div",{className:"text-sm text-gray-600",children:["Page ",F," of ",T]}),t.jsx("button",{type:"button",className:"ghost-btn",disabled:F>=T,onClick:()=>o(e=>Math.min(T,e+1)),children:"Next"})]}),t.jsx("div",{className:"mt-6",children:t.jsx(ee,{to:"/assistance",className:"ghost-btn",children:"Back to Assistance"})})]}),t.jsx(ye,{stateSlug:f,snippets:ie})]})};export{Se as default};
